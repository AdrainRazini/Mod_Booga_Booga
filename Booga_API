local VIM = game:GetService("VirtualInputManager")
local UIS = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local VirtualInputManager = game:GetService("VirtualInputManager")

--== Carregar MouseModule ==--
local success, MouseModule = pcall(function()
	return loadstring(game:HttpGet("https://raw.githubusercontent.com/AdrainRazini/mastermod/refs/heads/main/module/data.lua"))()
end)

if not success or not MouseModule then
	warn("‚ö† MouseModule n√£o foi carregado. Modo seguro ativado.")
	MouseModule = {}
	MouseModule.getMause = {
		GetPosition = function() return Vector2.new(0,0) end,
		IsLocked = function() return false end,
		LockMouse = function() end,
		UnlockMouse = function() end,
		Click = function() end,
		ClickUp = function() end,
		Scroll = function() end,
		Circle = function() end,
		Drag = function() end,
	}
end


-- ==========================================
-- Booga Booga IA
-- ==========================================

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

local Regui
local PlayerGui = game.Players.LocalPlayer:WaitForChild("PlayerGui")
local GuiName = "Mod_Animal_Simulator_" .. game.Players.LocalPlayer.Name

-- 1Ô∏è‚É£ Tenta carregar localmente
local success, module = pcall(function()
	return require(script.Parent:FindFirstChild("Mod_UI"))
end)

if success and module then
	Regui = module
	print("[‚úÖ Mod Loader] Carregado localmente com sucesso!")
else
	-- 2Ô∏è‚É£ Tenta baixar remoto
	local ok, code
	local urls = {
		"https://raw.githubusercontent.com/AdrainRazini/mastermod/refs/heads/main/module/dataGui.lua",
		"https://animal-simulator-server.vercel.app/lua/DataGui.lua"
	}

	for _, url in ipairs(urls) do
		local okHttp, result = pcall(function()
			return game:HttpGet(url)
		end)
		if okHttp and result and result ~= "" then
			code = result
			print("[üåê Mod Loader] C√≥digo baixado de: " .. url)
			break
		else
			warn("[‚ö†Ô∏è Mod Loader] Falha ao baixar de:", url)
		end
	end

	-- 3Ô∏è‚É£ Executa o c√≥digo remoto se baixado
	if code then
		local okLoad, result = pcall(function()
			return loadstring(code)() 
		end)
		if okLoad and result then
			Regui = result
			print("[‚úÖ Mod Loader] M√≥dulo remoto carregado com sucesso!")
		else
			warn("[‚ùå Mod Loader] Erro ao executar c√≥digo remoto:", result)
		end
	else
		warn("[‚ùå Mod Loader] Nenhuma das fontes p√¥de ser carregada.")
	end
end

assert(Regui, "Regui n√£o foi carregado!")



if PlayerGui:FindFirstChild(GuiName) then
	Regui.Notifications(PlayerGui, {Title="Alert", Text="Neutralized Code", Icon="fa_rr_information", Tempo=10})
	return
end

-- teste de Api Das Tags
-- üîπ Fun√ß√£o para buscar jogador na API com fallback e tratamento de erro

local RESULT = {
	ERRO = "Erro",
	INEXISTENTE = "Inexistente",
	DESCONHECIDO = "Desconhecido"
}

-- üîπ Fun√ß√£o para buscar jogador na API
local function getplayer(id)
	local url = "https://animal-simulator-server.vercel.app/api/player/" .. tostring(id)
	local response

	-- 1Ô∏è‚É£ Tenta HttpService:GetAsync
	local ok1, res1 = pcall(function()
		return HttpService:GetAsync(url)
	end)
	if ok1 then
		response = res1
	end

	-- 2Ô∏è‚É£ Fallback
	if not response then
		local ok2, res2 = pcall(function()
			return game:HttpGet(url)
		end)
		if ok2 then
			response = res2
		else
			return RESULT.ERRO
		end
	end

	-- 3Ô∏è‚É£ Decodificar JSON
	local okJson, data = pcall(function()
		return HttpService:JSONDecode(response)
	end)
	if not okJson then
		return RESULT.ERRO
	end

	-- 4Ô∏è‚É£ **TRATAMENTO ESPECIAL PARA SUA API**
	-- ‚úî Sucesso = true ‚Üí tag real
	if data.success == true then
		return data.Tag or RESULT.DESCONHECIDO
	end

	-- ‚úî Sucesso = false ‚Üí ver detalhes
	if data.message == "Jogador n√£o encontrado" 
		or data.message == "Jogador n√£o encontrado (cache criado)" then
		return RESULT.INEXISTENTE
	end

	-- ‚úî "Erro interno" ‚Üí trate como DESCONHECIDO (n√£o erro)
	if data.message == "Erro interno, mas resposta segura enviada" then
		return RESULT.DESCONHECIDO
	end

	-- Qualquer outra falha
	return RESULT.DESCONHECIDO
end


-- üß© Uso
local tag = getplayer(player.UserId)

local titleText = ({
	Livre = "‚úÖ Alert: Livre",
	Banido = "üö´ Alert: Banido",
	Erro = "‚ö†Ô∏è Alert: Erro ao consultar API",
	Inexistente = "‚úÖ Alert: ADN_MOD",
})[tag] or ("‚ÑπÔ∏è Alert: Tag desconhecida (" .. tostring(tag) .. ")")

-- üîî Notifica√ß√£o segura
if PlayerGui and Regui and Regui.Notifications then
	pcall(function()
		Regui.Notifications(PlayerGui, {
			Title = titleText,
			Text = "Status da conta: " .. tostring(tag),
			Icon = "fa_rr_information",
			Tempo = 10
		})
	end)
end

-- üß© Log + controle de fluxo
if tag == "Banido" then
	print("üö´ Jogador banido ‚Äî execu√ß√£o interrompida.")
	return -- ‚ùå interrompe aqui
else


	-- Continua normalmente para qualquer outro caso
	print("Status da conta:", tag)


end


-- FLAGS
local AUTO = {AllowMouseControl = false,  lock_mouse = false, auto_clicking = false, clickTask = nil}
local AF = {B = false}
local AF_Timer = {}
local PVP = {}
local PVP_Timer = {}

local G2L = {}


--==============================
-- FUN√á√ïES
--==============================
local function MoveMouseTo(targetPos, steps, delay)
	if not  AUTO.AllowMouseControl or not MouseModule then return end
	steps = steps or 20
	delay = delay or 0.01

	local startPos = MouseModule.getMause.GetPosition()
	local deltaX = (targetPos.X - startPos.X) / steps
	local deltaY = (targetPos.Y - startPos.Y) / steps

	for i = 1, steps do
		local newPos = Vector2.new(startPos.X + deltaX * i, startPos.Y + deltaY * i)
		if MouseModule.getMause.IsLocked() then
			MouseModule.getMause.LockMouse(newPos)
		else
			VirtualInputManager:SendMouseMoveEvent(newPos.X, newPos.Y, nil)
		end
		task.wait(delay)
	end
end

local function SafeClickUp(rightClick, duration)
	if not  AUTO.AllowMouseControl or not MouseModule then return end
	rightClick = rightClick or MouseModule.getMause.IsRightClick()
	duration = duration or 0.05
	MouseModule.getMause.ClickUp(rightClick, duration)
end


local function SafeClickUpAuto(rightClick, duration, valueFunc)
    if not  AUTO.AllowMouseControl or not MouseModule then return end

    rightClick = rightClick or MouseModule.getMause.IsRightClick()
    duration = duration or 0.05

    task.spawn(function()
        while  AUTO.AllowMouseControl 
            and typeof(valueFunc) == "function" 
            and valueFunc() do

            if MouseModule.getMause.ClickUp then
                MouseModule.getMause.ClickUp(rightClick, duration)
            end
            task.wait(duration)
        end
    end)
end


-- Fun√ß√£o para pegar o centro real de qualquer bot√£o/frame
local function getButtonCenter(button)
	-- Posi√ß√£o do canto superior esquerdo
	local absPos = button.AbsolutePosition
	local absSize = button.AbsoluteSize
	local anchor = button.AnchorPoint or Vector2.new(0,0)

	-- F√≥rmula universal (compensa automaticamente o AnchorPoint)
	return absPos + (absSize * anchor)
end


--===================--
-- Window Guis Tabs --
-- ‚¨á ‚¨á ‚¨á ‚¨á ‚¨á ‚¨á ‚¨á ‚¨á
--===================--
-- GUI
Window = Regui.TabsWindow({Title=GuiName, Text="Booga Booga", Size=UDim2.new(0, 350, 0, 250), Icon_btn = true})
FarmTab = Regui.CreateTab(Window,{Name="Farm"})

Control = Regui.CreateCheckboxe(FarmTab, {
	Text = "Ativar Control",
	Color = "White"
}, function(state)
    AUTO.AllowMouseControl = state

	if AUTO.AllowMouseControl then
		Regui.NotificationPerson(Window.Frame.Parent, {
			Title = "Alert",
			Text = "B ativado!" .. AUTO.AllowMouseControl ,
			Icon = "fa_envelope",
			Tempo = 10,
			Casch = {},
			Sound = ""
		}, function()
			print("Notifica√ß√£o fechada!")
		end)
	end

end)

Mouse = Regui.CreateCheckboxe(FarmTab, {
	Text = "Auto Click",
	Color = "White"
}, function(state)
    AUTO.auto_clicking = state

	if AUTO.auto_clicking then
		 -- Chama apenas uma vez, loop interno faz o resto
        SafeClickUpAuto(false, 0.05, function() return AF.B end)

		Regui.NotificationPerson(Window.Frame.Parent, {
			Title = "Alert",
			Text = "ativado!" .. auto_clicking ,
			Icon = "fa_envelope",
			Tempo = 10,
			Casch = {},
			Sound = ""
		}, function()
			print("Notifica√ß√£o fechada!")
		end)
	end

end)

G2L["ScreenGui"] = Instance.new("ScreenGui")
G2L["ScreenGui"].Name = "MouseController"
G2L["ScreenGui"].Parent = PlayerGui
G2L["ScreenGui"].ResetOnSpawn = false
-- Refer√™ncia
G2L["Referencia"] = Instance.new("Frame")
G2L["Referencia"].Parent = G2L["ScreenGui"]
G2L["Referencia"].Size = UDim2.new(0, 0, 0, 0)
G2L["Referencia"].Position = UDim2.new(0.5, 0, 0.5, 0)
G2L["Referencia"].BackgroundColor3 = Color3.fromRGB(255, 255, 255)

Lock_Mouse = Regui.CreateCheckboxe(FarmTab, {
	Text = "Lock Mouse",
	Color = "White"
}, function(state)
	if not MouseModule then return end

    local refPos = getButtonCenter(G2L["Referencia"])
	local mause = MouseModule.getMause

	if state then
		MouseModule.getMause.LockMouse(refPos)
	else
		MouseModule.getMause.UnlockMouse()
	end

end)

